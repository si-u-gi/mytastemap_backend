<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ‚úÖ Ïπ¥Ïπ¥Ïò§Îßµ JS SDK (Î∞òÎìúÏãú ÌïÑÏöî) -->
  <script
    src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=28d73fe896f3bb8829428aac2c341cf7"
  ></script>

  <style>
    * {
      -webkit-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
    }

    #map {
      width: 100%;
      height: 100%;
    }

    #filter-box {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      padding: 10px 12px;
      z-index: 9999;
      border-radius: 6px;
      font-size: 13px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      pointer-events: auto;
    }

    #filter-box input,
    #filter-box button {
      user-select: text;
      pointer-events: auto;
    }

    #filter-box button {
      margin-left: 5px;
      padding: 4px 10px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #filter-box input {
      width: 50px;
      padding: 2px 4px;
      border: 1px solid #ddd;
      border-radius: 3px;
      margin: 0 5px;
    }

    .marker-label {
      background: white;
      padding: 4px;
      font-size: 11px;
      border-radius: 4px;
      text-align: center;
      white-space: nowrap;
    }
  </style>
</head>

<body>
  <div id="filter-box">
    ‚≠ê ‚â• <input id="minRating" type="number" step="0.1" value="0">
    üìù ‚â• <input id="minReview" type="number" value="0">
    <button onclick="applyFilter()">Ï†ÅÏö©</button>
  </div>

  <div id="map"></div>

  <script>
    let map;
    let markers = [];
    let overlays = [];
    let allStores = [];

    // ‚úÖ ÏßÄÎèÑ Ï¥àÍ∏∞Ìôî (Ï§ëÏöî)
    window.onload = () => {
      map = new kakao.maps.Map(document.getElementById('map'), {
        center: new kakao.maps.LatLng(37.4979, 127.0276),
        level: 4
      });
    };

    // ‚úÖ Flutter ‚Üí JS Ìò∏Ï∂úÏö©
    function drawMarkers(stores) {
      allStores = stores;
      render(stores);
    }

    function render(stores) {
      clearAll();

      stores.forEach(store => {
        const position = new kakao.maps.LatLng(store.lat, store.lng);

        const marker = new kakao.maps.Marker({ position });
        marker.setMap(map);
        markers.push(marker);

        const overlay = new kakao.maps.CustomOverlay({
          position,
          content: `
            <div class="marker-label">
              <b>${store.name}</b><br/>
              ‚≠ê ${store.rating ?? 0} ¬∑ üìù ${store.reviewCount ?? 0}
            </div>
          `,
          yAnchor: 1.6
        });

        overlay.setMap(map);
        overlays.push(overlay);
      });
    }

    function clearAll() {
      markers.forEach(m => m.setMap(null));
      overlays.forEach(o => o.setMap(null));
      markers = [];
      overlays = [];
    }

    function applyFilter() {
      const minRating = Number(document.getElementById('minRating').value);
      const minReview = Number(document.getElementById('minReview').value);

      const filtered = allStores.filter(s =>
        (s.rating ?? 0) >= minRating &&
        (s.reviewCount ?? 0) >= minReview
      );

      render(filtered);
    }

    window.onload = () => {
    map = new kakao.maps.Map(
        document.getElementById('map'),
        {
        center: new kakao.maps.LatLng(37.4979, 127.0276),
        level: 4
        }
    );
    };
  </script>
</body>
</html>
